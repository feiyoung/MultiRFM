gendata_simu_multi <-function (seed = 1, nvec = c(100,300), p = 50, q = 3,
qs= rep(2, length(nvec)), err.type=c("gaussian", 'mvt', "exp", "t", "mixnorm", "pareto"),
rho = c(1,1), sigma2_eps=0.1, nu=1){
# seed = 1; nvec = c(100,300); p = 50; q = 3
# qs= rep(2, length(nvec))
# rho = 1; sigma2_eps=0.1;
if(length(nvec)<2) stop("nvec must have at least two elements!")
err.type <- match.arg(err.type)
S <- length(nvec)
require(MASS)
factor_term_A <- rho[1]
factor_term_B <- rho[2]
set.seed(1)
Blist <- list()
set.seed(1)
bmu0 <- matrix(rnorm(p*S), p, S)
Ztmp <- matrix(rnorm(p * (q+qs[1])), p, (q+qs[1]))
A <- qr(Ztmp)
A1 <- qr.Q(A) %*% Diag(seq(q+qs[1], 1, length=q+qs[1]))
A1 <- A1 %*% Diag(sign(A1[1, ]))*factor_term_A ## Fixed B0 and mu0 for each repeat.
A0 <- A1[,1:q]; B1 <- A1[,(q+1):(q+qs[1])]
t(A0) %*% A0; t(B1) %*% B1
Blist[[1]] <- B1
for(r in 2:S){
set.seed(r)
Ztmp <- matrix(rnorm(p * (qs[2])), p, (qs[2]))
A <- qr(Ztmp)
A1 <- qr.Q(A) %*% Diag(seq(qs[2], 1, length=qs[1]))  * factor_term_B
t(A1) %*% A1
Blist[[r]]   <- A1 %*% Diag(sign(A1[1, ]))
}
set.seed(seed)
Xlist <- list()
Flist <- list()
Hlist <- list()
for(s in 1:S){
n <- nvec[s]
if(err.type == 'gaussian'){
epsi <- MASS::mvrnorm(n, mu=rep(0, p), Sigma = diag(rep(p,1))* sigma2_eps)
}else if(err.type == 'mvt'){
epsi <- mvtnorm::rmvt(n, sigma =sigma2_eps* diag(p), df=nu)
#matrix(rt(n*p, df=nu), n, p) *
}else if(err.type == 'exp'){
epsi <- (matrix(rexp(n*p), n, p)-1) * sqrt(sigma2_eps)
#matrix(rt(n*p, df=nu), n, p) *
}else if(err.type == 't'){
epsi <- matrix(rt(n*p, df=nu), n, p)  * sqrt(sigma2_eps)
}else if(err.type == 'mixnorm'){
library(mixtools)
lambda <- rep(1, 2)/2
mu <- c(-5, 5)
sigma <- rep(1, 2)
epsi <- matrix(rnormmix(n*p, lambda, mu, sigma), n, p)  * sqrt(sigma2_eps)
}else if(err.type== 'pareto'){
library(LaplacesDemon)
alpha=2;n <- 1000
x <- rpareto(n*p, alpha) - alpha/(alpha-1)
epsi <- matrix(x, n, p)  * sqrt(sigma2_eps)
}
FH <- mvrnorm(n, mu = rep(0, q+qs[s]), Diag(rep(1,q+qs[s])))
Flist[[s]] <- FH[,1:q]
Hlist[[s]] <- FH[,(q+1):(q+qs[s])]
AB1 <- cbind(A0, Blist[[s]])
Xlist[[s]]  <- matrix(bmu0[,s], nrow=n, ncol=p, byrow = TRUE) + FH %*% t(AB1) + epsi
}
return(list(Xlist = Xlist, mu0=bmu0, A0 = A0, Blist0 = Blist,
Flist = Flist, Hlist = Hlist,  q=q, qs=qs))
}
devtools::document()
devtools::document()
devtools::document()
rm(list = c("gendata_simu_multi"))
devtools::document()
devtools::document()
devtools::document()
?MultiRFM
seed<-1
nu <- 5
p <- 100
nvec <- c(150,200); d <- 3; q <- 3;qs <- c(2,2); S <- length(nvec)
datList <- gendata_simu_multi(seed=i, nvec=nvec, p=p, q=q, qs=qs, rho=rho,
err.type='mvt', sigma2_eps = sigma2_eps, nu=nu)
rho=c(5,5)
sigma2_eps <- 1
datList <- gendata_simu_multi(seed=i, nvec=nvec, p=p, q=q, qs=qs, rho=rho,
err.type='mvt', sigma2_eps = sigma2_eps, nu=nu)
datList <- gendata_simu_multi(seed=1, nvec=nvec, p=p, q=q, qs=qs, rho=rho,
err.type='mvt', sigma2_eps = sigma2_eps, nu=nu)
XList <- datList$Xlist;
res <- MultiRFM(XList, q=q, qs= qs)
str(res)
hqlist <- selectFac.MultiRFM(XList, q=q_max, qs= rep(qs_max,2))
hqlist <- selectFac.MultiRFM(XList, q_max=6, qs_max= rep(4,2))
devtools::document()
devtools::document()
stats::rt
stats::rt
devtools::document()
library(MultiRFM)
?gendata_simu_multi
devtools::document()
pkgload::dev_help('gendata_simu_multi')
devtools::document()
devtools::document()
devtools::document()
set.seed(123)
sim_data <- gendata_simu_multi(
seed = 123,
nvec = c(100, 200),
p = 50,
q = 3,          # 3 common factors
qs = c(2, 2),   # 2 specific factors per study
err.type = "gaussian",
rho = c(1, 1),
sigma2_eps = 0.1
)
str(sim_data)  # Check structure of simulated data
# Extract true parameters for model evaluation
true_A <- sim_data_mvt$A0        # True common loadings
devtools::document()
example("MultiRFM")
?MultiRFM
p <- 100
nvec <- c(150,200); qs <- c(2,2)
datList <- gendata_simu_multi(seed=1, nvec=nvec, p=p, q=3, qs=qs, rho=c(5,5),
err.type='mvt', sigma2_eps = 1, nu=3)
XList <- datList$Xlist;
res <- MultiRFM(XList, q=q, qs= qs)
devtools::document()
p <- 100
nvec <- c(150,200); qs <- c(2,2)
datList <- gendata_simu_multi(seed=1, nvec=nvec, p=p, q=3, qs=qs, rho=c(5,5),
err.type='mvt', sigma2_eps = 1, nu=3)
XList <- datList$Xlist;
res <- MultiRFM(XList, q=3, qs= qs)
str(res)
?gendata_simu_multi
devtools::document()
devtools::document()
pkgload::dev_help('gendata_simu_multi')
devtools::document()
devtools::document()
pkgload::dev_help('gendata_simu_multi')
devtools::document()
devtools::document()
?gendata_simu_multi
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
example("selectFac.MultiRFM")
?selectFac.MultiRFM
p <- 100
nvec <- c(150,200); qs <- c(2,2)
datList <- gendata_simu_multi(seed=1, nvec=nvec, p=p, q=3, qs=qs, rho=c(5,5),
err.type='mvt', sigma2_eps = 1, nu=3)
XList <- datList$Xlist;
hqlist <- selectFac.MultiRFM(XList, q_max=6, qs_max= rep(4,2))
str(hqlist)
hqlist <- selectFac.MultiRFM(XList, q_max=6, qs_max= rep(4,2), maxIter = 5) #
str(hqlist)
devtools::document()
devtools::document()
library(MultiRFM)
library(GFM)
trace_statistic_fun <- function(H, H0){
tr_fun <- function(x) sum(diag(x))
mat1 <- t(H0) %*% H %*% qr.solve(t(H) %*% H) %*% t(H) %*% H0
tr_fun(mat1) / tr_fun(t(H0) %*% H0)
}
trace_list_fun <- function(Hlist, H0list){
trvec <- rep(NA, length(Hlist))
for(i in seq_along(trvec)){
trvec[i] <- trace_statistic_fun(Hlist[[i]], H0list[[i]])
}
return(mean(trvec))
}
library(MultiRFM)
trace_statistic_fun <- function(H, H0){
tr_fun <- function(x) sum(diag(x))
mat1 <- t(H0) %*% H %*% qr.solve(t(H) %*% H) %*% t(H) %*% H0
tr_fun(mat1) / tr_fun(t(H0) %*% H0)
}
trace_list_fun <- function(Hlist, H0list){
trvec <- rep(NA, length(Hlist))
for(i in seq_along(trvec)){
trvec[i] <- trace_statistic_fun(Hlist[[i]], H0list[[i]])
}
return(mean(trvec))
}
rm(list=ls())
library(MultiRFM)
trace_statistic_fun <- function(H, H0){
tr_fun <- function(x) sum(diag(x))
mat1 <- t(H0) %*% H %*% qr.solve(t(H) %*% H) %*% t(H) %*% H0
tr_fun(mat1) / tr_fun(t(H0) %*% H0)
}
trace_list_fun <- function(Hlist, H0list){
trvec <- rep(NA, length(Hlist))
for(i in seq_along(trvec)){
trvec[i] <- trace_statistic_fun(Hlist[[i]], H0list[[i]])
}
return(mean(trvec))
}
nu <- 2 # nu is set to
p <- 400
nvec <- c(150,200); d <- 3; q <- 3;qs <- c(2,2); S <- length(nvec)
sigma2_eps <- 1
datList <- gendata_simu_multi(seed=i, nvec=nvec, p=p, q=q, qs=qs, rho=c(5,5), err.type='mvt', sigma2_eps = sigma2_eps, nu=nu)
nu <- 2 # nu is set to
p <- 400
nvec <- c(150,200); d <- 3; q <- 3;qs <- c(2,2); S <- length(nvec)
sigma2_eps <- 1
datList <- gendata_simu_multi(seed=1, nvec=nvec, p=p, q=q, qs=qs, rho=c(5,5), err.type='mvt', sigma2_eps = sigma2_eps, nu=nu)
methodNames <- c("MultiRFM", "MSFA-CAVI", "MSFA-SVI")
metricMat <- matrix(NA, nrow=length(methodNames), ncol=6)
colnames(metricMat) <- c('A_tr', 'B_tr',  'F_tr', 'H_tr', 'Time')
methodNames <- c("MultiRFM", "MSFA-CAVI", "MSFA-SVI")
metricMat <- matrix(NA, nrow=length(methodNames), ncol=5)
colnames(metricMat) <- c('A_tr', 'B_tr',  'F_tr', 'H_tr', 'Time')
row.names(metricMat) <- methodNames
XList <- datList$Xlist;
res <- MultiRFM(XList, q=q, qs=qs)
#str(res)
metricMat["MultiRFM",'Time'] <- res$time.use
res$time.use
str(res)
methodNames <- c("MultiRFM", "MSFA-CAVI", "MSFA-SVI")
metricMat <- matrix(NA, nrow=length(methodNames), ncol=5)
colnames(metricMat) <- c('A_tr', 'B_tr',  'F_tr', 'H_tr', 'Time')
row.names(metricMat) <- methodNames
XList <- datList$Xlist;
# res <- MultiRFM(XList, q=q, qs=qs)
#str(res)
metricMat["MultiRFM",'Time'] <- res$time_use
metricMat["MultiRFM",'A_tr'] <- trace_statistic_fun(res$A, datList$A0)
metricMat["MultiRFM",'B_tr'] <- trace_list_fun(res$B, datList$Blist0)
metricMat["MultiRFM",'F_tr'] <- trace_list_fun(res$F, datList$Flist)
metricMat["MultiRFM",'H_tr'] <- trace_list_fun(res$H, datList$Hlist)
metricMat
X_s <- lapply(XList, scale, scale=FALSE)
hmu <- sapply(XList, colMeans)
library(VIMSFA)
### MSFA-CAVI
print("MSFA-CAVI")
tic <- proc.time()
cavi_est <- cavi_msfa(X_s,  K=q, J_s=qs)
toc <- proc.time()
time_cavi <- toc[3] - tic[3]
hLam <- Reduce(cbind, cavi_est$mean_psi_s)
hF_cavi <- hH_cavi <- list()
for(s in 1:S){
# s <- 1
hF_cavi[[s]] <- t(Reduce(cbind, cavi_est$mean_f[[s]]))
hH_cavi[[s]] <- t(Reduce(cbind, cavi_est$mean_l[[s]]))
}
metricMat["MSFA-CAVI",'Time']  <- time_cavi
metricMat["MultiRFM",'A_tr']  <- trace_statistic_fun(cavi_est$mean_phi, datList$A0)
metricMat["MultiRFM",'A_tr'] $B_tr[i, 3] <- trace_list_fun(cavi_est$mean_lambda_s, datList$Blist0)
# X_s <- lapply(XList, scale, scale=FALSE)
# hmu <- sapply(XList, colMeans)
# library(VIMSFA)
# ### MSFA-CAVI
# print("MSFA-CAVI")
# tic <- proc.time()
# cavi_est <- cavi_msfa(X_s,  K=q, J_s=qs)
# toc <- proc.time()
# time_cavi <- toc[3] - tic[3]
# hLam <- Reduce(cbind, cavi_est$mean_psi_s)
# hF_cavi <- hH_cavi <- list()
# for(s in 1:S){
#   # s <- 1
#   hF_cavi[[s]] <- t(Reduce(cbind, cavi_est$mean_f[[s]]))
#   hH_cavi[[s]] <- t(Reduce(cbind, cavi_est$mean_l[[s]]))
# }
metricMat["MSFA-CAVI",'Time']  <- time_cavi
metricMat["MultiRFM",'A_tr']  <- trace_statistic_fun(cavi_est$mean_phi, datList$A0)
metricMat["MultiRFM",'B_tr']  <- trace_list_fun(cavi_est$mean_lambda_s, datList$Blist0)
metricMat["MultiRFM",'F_tr'] <- trace_list_fun(hF_cavi, datList$Flist)
metricMat["MultiRFM",'H_tr'] <- trace_list_fun(hH_cavi, datList$Hlist)
metricMat
# X_s <- lapply(XList, scale, scale=FALSE)
# hmu <- sapply(XList, colMeans)
# library(VIMSFA)
# ### MSFA-CAVI
# print("MSFA-CAVI")
# tic <- proc.time()
# cavi_est <- cavi_msfa(X_s,  K=q, J_s=qs)
# toc <- proc.time()
# time_cavi <- toc[3] - tic[3]
# hLam <- Reduce(cbind, cavi_est$mean_psi_s)
# hF_cavi <- hH_cavi <- list()
# for(s in 1:S){
#   # s <- 1
#   hF_cavi[[s]] <- t(Reduce(cbind, cavi_est$mean_f[[s]]))
#   hH_cavi[[s]] <- t(Reduce(cbind, cavi_est$mean_l[[s]]))
# }
metricMat["MSFA-CAVI",'Time']  <- time_cavi
metricMat["MSFA-CAVI",'A_tr']  <- trace_statistic_fun(cavi_est$mean_phi, datList$A0)
metricMat["MSFA-CAVI",'B_tr']  <- trace_list_fun(cavi_est$mean_lambda_s, datList$Blist0)
metricMat["MSFA-CAVI",'F_tr'] <- trace_list_fun(hF_cavi, datList$Flist)
metricMat["MSFA-CAVI",'H_tr'] <- trace_list_fun(hH_cavi, datList$Hlist)
methodNames <- c("MultiRFM", "MSFA-CAVI", "MSFA-SVI")
metricMat <- matrix(NA, nrow=length(methodNames), ncol=5)
colnames(metricMat) <- c('A_tr', 'B_tr',  'F_tr', 'H_tr', 'Time')
row.names(metricMat) <- methodNames
XList <- datList$Xlist;
# res <- MultiRFM(XList, q=q, qs=qs)
#str(res)
metricMat["MultiRFM",'Time'] <- res$time_use
metricMat["MultiRFM",'A_tr'] <- trace_statistic_fun(res$A, datList$A0)
metricMat["MultiRFM",'B_tr'] <- trace_list_fun(res$B, datList$Blist0)
metricMat["MultiRFM",'F_tr'] <- trace_list_fun(res$F, datList$Flist)
metricMat["MultiRFM",'H_tr'] <- trace_list_fun(res$H, datList$Hlist)
# X_s <- lapply(XList, scale, scale=FALSE)
# hmu <- sapply(XList, colMeans)
# library(VIMSFA)
# ### MSFA-CAVI
# print("MSFA-CAVI")
# tic <- proc.time()
# cavi_est <- cavi_msfa(X_s,  K=q, J_s=qs)
# toc <- proc.time()
# time_cavi <- toc[3] - tic[3]
# hLam <- Reduce(cbind, cavi_est$mean_psi_s)
# hF_cavi <- hH_cavi <- list()
# for(s in 1:S){
#   # s <- 1
#   hF_cavi[[s]] <- t(Reduce(cbind, cavi_est$mean_f[[s]]))
#   hH_cavi[[s]] <- t(Reduce(cbind, cavi_est$mean_l[[s]]))
# }
metricMat["MSFA-CAVI",'Time']  <- time_cavi
metricMat["MSFA-CAVI",'A_tr']  <- trace_statistic_fun(cavi_est$mean_phi, datList$A0)
metricMat["MSFA-CAVI",'B_tr']  <- trace_list_fun(cavi_est$mean_lambda_s, datList$Blist0)
metricMat["MSFA-CAVI",'F_tr'] <- trace_list_fun(hF_cavi, datList$Flist)
metricMat["MSFA-CAVI",'H_tr'] <- trace_list_fun(hH_cavi, datList$Hlist)
print("MSFA-SVI")
tic <- proc.time()
svi_est <- svi_msfa(X_s, K=q, J_s=qs, verbose = 0)
toc <- proc.time()
time_svi <- toc[3] - tic[3]
hLam <- Reduce(cbind, svi_est$mean_psi_s)
hF_cavi <- hH_cavi <- list()
for(s in 1:S){
# s <- 1
hF_cavi[[s]] <- t(Reduce(cbind, svi_est$mean_f[[s]]))
hH_cavi[[s]] <- t(Reduce(cbind, svi_est$mean_l[[s]]))
}
metricMat["MSFA-SVI",'Time']  <- time_cavi
metricMat["MSFA-SVI",'A_tr']  <- trace_statistic_fun(svi_est$mean_phi, datList$A0)
metricMat["MSFA-SVI",'B_tr']  <- trace_list_fun(svi_est$mean_lambda_s, datList$Blist0)
metricMat["MSFA-SVI",'F_tr'] <- trace_list_fun(hF_cavi, datList$Flist)
metricMat["MSFA-SVI",'H_tr'] <- trace_list_fun(hH_cavi, datList$Hlist)
dat_metric <- data.frame(metricMat)
dat_metric$Method <- factor(row.names(dat_metric), levels=row.names(dat_metric))
library(cowplot)
library(ggplot2)
p1 <- ggplot(data=subset(dat_metric, !is.na(A_tr)), aes(x= Method, y=A_tr, fill=Method)) + geom_bar(stat="identity") + xlab(NULL) + scale_x_discrete(breaks=NULL) + theme_bw(base_size = 16)
p2 <- ggplot(data=subset(dat_metric, !is.na(F_tr)), aes(x= Method, y=F_tr, fill=Method)) + geom_bar(stat="identity") + xlab(NULL) + scale_x_discrete(breaks=NULL)+ theme_bw(base_size = 16)
p3 <- ggplot(data=subset(dat_metric, !is.na(B_tr)), aes(x= Method, y=B_tr, fill=Method)) + geom_bar(stat="identity") + xlab(NULL) + scale_x_discrete(breaks=NULL) + theme_bw(base_size = 16)
p4 <- ggplot(data=subset(dat_metric, !is.na(H_tr)), aes(x= Method, y=H_tr, fill=Method)) + geom_bar(stat="identity") + xlab(NULL) + scale_x_discrete(breaks=NULL)+ theme_bw(base_size = 16)
p5 <- ggplot(data=subset(dat_metric, !is.na(Time)), aes(x= Method, y=Time, fill=Method)) + geom_bar(stat="identity") + xlab(NULL) + scale_x_discrete(breaks=NULL)+ theme_bw(base_size = 16)
plot_grid(p1,p2,p3, p4,  p5, nrow=2, ncol=3)
XList <- datList$Xlist;
q_max <- 6; qs_max <- 4
hq.list <- selectFac.MultiRFM(XList,  q=q_max, qs=qs_max, verbose = FALSE)
selectFac.MultiRFM
hq.list <- selectFac.MultiRFM(XList,  q_max=q_max, qs_max=qs_max, verbose = FALSE)
message("hq = ", hq.list$q, " VS true q = ", q)
message("hqs.vec = ", paste(hq.list$qs, collapse =", "), " VS true qs.vec = ", paste(qs, collapse =", "))
datList <- gendata_simu_multi(seed=1, nvec=nvec, p=p, q=q, qs=qs, rho=c(5,5), err.type='mvt', sigma2_eps =
sigma2_eps, nu=3)
XList <- datList$Xlist;
q_max <- 6; qs_max <- 4
hq.list <- selectFac.MultiRFM(XList,  q_max=q_max, qs_max=qs_max, verbose = FALSE)
hq.list <- selectFac.MultiRFM(XList,  q_max=q_max, qs_max=qs_max, verbose = FALSE)
message("hq = ", hq.list$q, " VS true q = ", q)
message("hqs.vec = ", paste(hq.list$qs, collapse =", "), " VS true qs.vec = ", paste(qs, collapse =", "))
pkgdown::build_site()
pkgdown::build_site()
library(ggpubr)
pkgdown::build_home()
pkgdown::preview_site(path='index.html')
library(MultiRFM)
trace_statistic_fun <- function(H, H0){
tr_fun <- function(x) sum(diag(x))
mat1 <- t(H0) %*% H %*% qr.solve(t(H) %*% H) %*% t(H) %*% H0
tr_fun(mat1) / tr_fun(t(H0) %*% H0)
}
trace_list_fun <- function(Hlist, H0list){
trvec <- rep(NA, length(Hlist))
for(i in seq_along(trvec)){
trvec[i] <- trace_statistic_fun(Hlist[[i]], H0list[[i]])
}
return(mean(trvec))
}
nu <- 3 # nu is set to
p <- 100
nvec <- c(150,200);  q <- 3;qs <- c(2,2); S <- length(nvec)
sigma2_eps <- 1
datList <- gendata_simu_multi(seed=1, nvec=nvec, p=p, q=q, qs=qs, rho=c(5,5), err.type='mvt', sigma2_eps = sigma2_eps, nu=nu)
methodNames <- c("MultiRFM", "MSFA-CAVI", "MSFA-SVI")
metricMat <- matrix(NA, nrow=length(methodNames), ncol=5)
colnames(metricMat) <- c('A_tr', 'B_tr',  'F_tr', 'H_tr', 'Time')
row.names(metricMat) <- methodNames
XList <- datList$Xlist;
res <- MultiRFM(XList, q=q, qs=qs)
#str(res)
metricMat["MultiRFM",'Time'] <- res$time_use
metricMat["MultiRFM",'A_tr'] <- trace_statistic_fun(res$A, datList$A0)
metricMat["MultiRFM",'B_tr'] <- trace_list_fun(res$B, datList$Blist0)
metricMat["MultiRFM",'F_tr'] <- trace_list_fun(res$F, datList$Flist)
metricMat["MultiRFM",'H_tr'] <- trace_list_fun(res$H, datList$Hlist)
X_s <- lapply(XList, scale, scale=FALSE)
hmu <- sapply(XList, colMeans)
library(VIMSFA)
### MSFA-CAVI
print("MSFA-CAVI")
tic <- proc.time()
cavi_est <- cavi_msfa(X_s,  K=q, J_s=qs)
toc <- proc.time()
time_cavi <- toc[3] - tic[3]
hLam <- Reduce(cbind, cavi_est$mean_psi_s)
hF_cavi <- hH_cavi <- list()
for(s in 1:S){
# s <- 1
hF_cavi[[s]] <- t(Reduce(cbind, cavi_est$mean_f[[s]]))
hH_cavi[[s]] <- t(Reduce(cbind, cavi_est$mean_l[[s]]))
}
metricMat["MSFA-CAVI",'Time']  <- time_cavi
metricMat["MSFA-CAVI",'A_tr']  <- trace_statistic_fun(cavi_est$mean_phi, datList$A0)
metricMat["MSFA-CAVI",'B_tr']  <- trace_list_fun(cavi_est$mean_lambda_s, datList$Blist0)
metricMat["MSFA-CAVI",'F_tr'] <- trace_list_fun(hF_cavi, datList$Flist)
metricMat["MSFA-CAVI",'H_tr'] <- trace_list_fun(hH_cavi, datList$Hlist)
print("MSFA-SVI")
tic <- proc.time()
svi_est <- svi_msfa(X_s, K=q, J_s=qs, verbose = 0)
toc <- proc.time()
time_svi <- toc[3] - tic[3]
hLam <- Reduce(cbind, svi_est$mean_psi_s)
hF_cavi <- hH_cavi <- list()
for(s in 1:S){
# s <- 1
hF_cavi[[s]] <- t(Reduce(cbind, svi_est$mean_f[[s]]))
hH_cavi[[s]] <- t(Reduce(cbind, svi_est$mean_l[[s]]))
}
metricMat["MSFA-SVI",'Time']  <- time_cavi
metricMat["MSFA-SVI",'A_tr']  <- trace_statistic_fun(svi_est$mean_phi, datList$A0)
metricMat["MSFA-SVI",'B_tr']  <- trace_list_fun(svi_est$mean_lambda_s, datList$Blist0)
metricMat["MSFA-SVI",'F_tr'] <- trace_list_fun(hF_cavi, datList$Flist)
metricMat["MSFA-SVI",'H_tr'] <- trace_list_fun(hH_cavi, datList$Hlist)
dat_metric <- data.frame(metricMat)
dat_metric$Method <- factor(row.names(dat_metric), levels=row.names(dat_metric))
library(cowplot)
library(ggplot2)
p1 <- ggplot(data=subset(dat_metric, !is.na(A_tr)), aes(x= Method, y=A_tr, fill=Method)) + geom_bar(stat="identity") + xlab(NULL) + scale_x_discrete(breaks=NULL) + theme_bw(base_size = 16)
p2 <- ggplot(data=subset(dat_metric, !is.na(F_tr)), aes(x= Method, y=F_tr, fill=Method)) + geom_bar(stat="identity") + xlab(NULL) + scale_x_discrete(breaks=NULL)+ theme_bw(base_size = 16)
p3 <- ggplot(data=subset(dat_metric, !is.na(B_tr)), aes(x= Method, y=B_tr, fill=Method)) + geom_bar(stat="identity") + xlab(NULL) + scale_x_discrete(breaks=NULL) + theme_bw(base_size = 16)
p4 <- ggplot(data=subset(dat_metric, !is.na(H_tr)), aes(x= Method, y=H_tr, fill=Method)) + geom_bar(stat="identity") + xlab(NULL) + scale_x_discrete(breaks=NULL)+ theme_bw(base_size = 16)
p5 <- ggplot(data=subset(dat_metric, !is.na(Time)), aes(x= Method, y=Time, fill=Method)) + geom_bar(stat="identity") + xlab(NULL) + scale_x_discrete(breaks=NULL)+ theme_bw(base_size = 16)
plot_grid(p1,p2,p3, p4,  p5, nrow=2, ncol=3)
datList <- gendata_simu_multi(seed=1, nvec=nvec, p=p, q=q, qs=qs, rho=c(5,5), err.type='mvt', sigma2_eps =
sigma2_eps, nu=3)
XList <- datList$Xlist;
q_max <- 6; qs_max <- 4
hq.list <- selectFac.MultiRFM(XList,  q_max=q_max, qs_max=qs_max, verbose = FALSE)
message("hq = ", hq.list$q, " VS true q = ", q)
message("hqs.vec = ", paste(hq.list$qs, collapse =", "), " VS true qs.vec = ", paste(qs, collapse =", "))
pkgdown::build_article("simu_low_dim")
pkgdown::build_article("simu_low_dim")
pkgdown::preview_site(path='articles/simu_low_dim.html')
pkgdown::build_article("simu_low_dim")
pkgdown::preview_site(path='articles/simu_low_dim.html')
pkgdown::build_home()
pkgdown::preview_site(path='index.html')
library(Seurat)
PrepSCTIntegration
