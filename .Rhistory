gendata_simu_multi <-function (seed = 1, nvec = c(100,300), p = 50, q = 3,
qs= rep(2, length(nvec)), err.type=c("gaussian", 'mvt', "exp", "t", "mixnorm", "pareto"),
rho = c(1,1), sigma2_eps=0.1, nu=1){
# seed = 1; nvec = c(100,300); p = 50; q = 3
# qs= rep(2, length(nvec))
# rho = 1; sigma2_eps=0.1;
if(length(nvec)<2) stop("nvec must have at least two elements!")
err.type <- match.arg(err.type)
S <- length(nvec)
require(MASS)
factor_term_A <- rho[1]
factor_term_B <- rho[2]
set.seed(1)
Blist <- list()
set.seed(1)
bmu0 <- matrix(rnorm(p*S), p, S)
Ztmp <- matrix(rnorm(p * (q+qs[1])), p, (q+qs[1]))
A <- qr(Ztmp)
A1 <- qr.Q(A) %*% Diag(seq(q+qs[1], 1, length=q+qs[1]))
A1 <- A1 %*% Diag(sign(A1[1, ]))*factor_term_A ## Fixed B0 and mu0 for each repeat.
A0 <- A1[,1:q]; B1 <- A1[,(q+1):(q+qs[1])]
t(A0) %*% A0; t(B1) %*% B1
Blist[[1]] <- B1
for(r in 2:S){
set.seed(r)
Ztmp <- matrix(rnorm(p * (qs[2])), p, (qs[2]))
A <- qr(Ztmp)
A1 <- qr.Q(A) %*% Diag(seq(qs[2], 1, length=qs[1]))  * factor_term_B
t(A1) %*% A1
Blist[[r]]   <- A1 %*% Diag(sign(A1[1, ]))
}
set.seed(seed)
Xlist <- list()
Flist <- list()
Hlist <- list()
for(s in 1:S){
n <- nvec[s]
if(err.type == 'gaussian'){
epsi <- MASS::mvrnorm(n, mu=rep(0, p), Sigma = diag(rep(p,1))* sigma2_eps)
}else if(err.type == 'mvt'){
epsi <- mvtnorm::rmvt(n, sigma =sigma2_eps* diag(p), df=nu)
#matrix(rt(n*p, df=nu), n, p) *
}else if(err.type == 'exp'){
epsi <- (matrix(rexp(n*p), n, p)-1) * sqrt(sigma2_eps)
#matrix(rt(n*p, df=nu), n, p) *
}else if(err.type == 't'){
epsi <- matrix(rt(n*p, df=nu), n, p)  * sqrt(sigma2_eps)
}else if(err.type == 'mixnorm'){
library(mixtools)
lambda <- rep(1, 2)/2
mu <- c(-5, 5)
sigma <- rep(1, 2)
epsi <- matrix(rnormmix(n*p, lambda, mu, sigma), n, p)  * sqrt(sigma2_eps)
}else if(err.type== 'pareto'){
library(LaplacesDemon)
alpha=2;n <- 1000
x <- rpareto(n*p, alpha) - alpha/(alpha-1)
epsi <- matrix(x, n, p)  * sqrt(sigma2_eps)
}
FH <- mvrnorm(n, mu = rep(0, q+qs[s]), Diag(rep(1,q+qs[s])))
Flist[[s]] <- FH[,1:q]
Hlist[[s]] <- FH[,(q+1):(q+qs[s])]
AB1 <- cbind(A0, Blist[[s]])
Xlist[[s]]  <- matrix(bmu0[,s], nrow=n, ncol=p, byrow = TRUE) + FH %*% t(AB1) + epsi
}
return(list(Xlist = Xlist, mu0=bmu0, A0 = A0, Blist0 = Blist,
Flist = Flist, Hlist = Hlist,  q=q, qs=qs))
}
devtools::document()
devtools::document()
devtools::document()
rm(list = c("gendata_simu_multi"))
devtools::document()
devtools::document()
devtools::document()
?MultiRFM
seed<-1
nu <- 5
p <- 100
nvec <- c(150,200); d <- 3; q <- 3;qs <- c(2,2); S <- length(nvec)
datList <- gendata_simu_multi(seed=i, nvec=nvec, p=p, q=q, qs=qs, rho=rho,
err.type='mvt', sigma2_eps = sigma2_eps, nu=nu)
rho=c(5,5)
sigma2_eps <- 1
datList <- gendata_simu_multi(seed=i, nvec=nvec, p=p, q=q, qs=qs, rho=rho,
err.type='mvt', sigma2_eps = sigma2_eps, nu=nu)
datList <- gendata_simu_multi(seed=1, nvec=nvec, p=p, q=q, qs=qs, rho=rho,
err.type='mvt', sigma2_eps = sigma2_eps, nu=nu)
XList <- datList$Xlist;
res <- MultiRFM(XList, q=q, qs= qs)
str(res)
hqlist <- selectFac.MultiRFM(XList, q=q_max, qs= rep(qs_max,2))
hqlist <- selectFac.MultiRFM(XList, q_max=6, qs_max= rep(4,2))
devtools::document()
devtools::document()
stats::rt
stats::rt
devtools::document()
library(MultiRFM)
?gendata_simu_multi
devtools::document()
pkgload::dev_help('gendata_simu_multi')
devtools::document()
devtools::document()
devtools::document()
set.seed(123)
sim_data <- gendata_simu_multi(
seed = 123,
nvec = c(100, 200),
p = 50,
q = 3,          # 3 common factors
qs = c(2, 2),   # 2 specific factors per study
err.type = "gaussian",
rho = c(1, 1),
sigma2_eps = 0.1
)
str(sim_data)  # Check structure of simulated data
# Extract true parameters for model evaluation
true_A <- sim_data_mvt$A0        # True common loadings
devtools::document()
example("MultiRFM")
?MultiRFM
p <- 100
nvec <- c(150,200); qs <- c(2,2)
datList <- gendata_simu_multi(seed=1, nvec=nvec, p=p, q=3, qs=qs, rho=c(5,5),
err.type='mvt', sigma2_eps = 1, nu=3)
XList <- datList$Xlist;
res <- MultiRFM(XList, q=q, qs= qs)
devtools::document()
p <- 100
nvec <- c(150,200); qs <- c(2,2)
datList <- gendata_simu_multi(seed=1, nvec=nvec, p=p, q=3, qs=qs, rho=c(5,5),
err.type='mvt', sigma2_eps = 1, nu=3)
XList <- datList$Xlist;
res <- MultiRFM(XList, q=3, qs= qs)
str(res)
?gendata_simu_multi
devtools::document()
devtools::document()
pkgload::dev_help('gendata_simu_multi')
devtools::document()
devtools::document()
pkgload::dev_help('gendata_simu_multi')
devtools::document()
devtools::document()
?gendata_simu_multi
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
example("selectFac.MultiRFM")
?selectFac.MultiRFM
p <- 100
nvec <- c(150,200); qs <- c(2,2)
datList <- gendata_simu_multi(seed=1, nvec=nvec, p=p, q=3, qs=qs, rho=c(5,5),
err.type='mvt', sigma2_eps = 1, nu=3)
XList <- datList$Xlist;
hqlist <- selectFac.MultiRFM(XList, q_max=6, qs_max= rep(4,2))
str(hqlist)
hqlist <- selectFac.MultiRFM(XList, q_max=6, qs_max= rep(4,2), maxIter = 5) #
str(hqlist)
devtools::document()
devtools::document()
